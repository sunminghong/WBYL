<?php
if(!defined('ISWBYL')) exit('Access Denied');

class my extends ctl_base {

	public function index(){
		$this->set("title","我的地盘");	

		$this->set("users",envhelper::readToken());
		$this->display("home_my_index");
	}
		
	public function home_timeline(){echo '[{"created_at":"Fri Apr 22 18:02:33 +0800 2011","id":9506113914,"text":"\u5e99\u5802\u4e4b\u4e0a\uff0c\u673d\u6728\u4e3a\u5b98\uff0c \u6bbf\u965b\u4e4b\u95f4\uff0c\u79bd\u517d\u98df\u7984\uff1b \u72fc\u5fc3\u72d7\u884c\u4e4b\u8f88\uff0c\u6eda\u6eda\u5f53\u671d\uff0c \u5974\u989c\u5a62\u819d\u4e4b\u5f92\uff0c\u7eb7\u7eb7\u79c9\u653f\u3002","source":"<a href=\"http:\/\/weibo.com\" rel=\"nofollow\">\u65b0\u6d6a\u5fae\u535a<\/a>","favorited":false,"truncated":false,"in_reply_to_status_id":"","in_reply_to_user_id":"","in_reply_to_screen_name":"","geo":null,"mid":"5598346217426261904","user":{"id":1728663051,"screen_name":"\u7f57\u4e1c\u5cf0","name":"\u7f57\u4e1c\u5cf0","province":"51","city":"9","location":"\u56db\u5ddd \u9042\u5b81","description":"\u6bcf\u5929\u90fd\u662f\u65b0\u9c9c\u7684\u3002","url":"","profile_image_url":"http:\/\/tp4.sinaimg.cn\/1728663051\/50\/5597920196\/1","domain":"aixinjueluozhicaizi","gender":"m","followers_count":18,"friends_count":75,"statuses_count":30,"favourites_count":0,"created_at":"Sun Apr 11 00:00:00 +0800 2010","following":false,"allow_all_act_msg":true,"geo_enabled":true,"verified":false},"annotations":[{"cartoon":false}]},{"created_at":"Fri Apr 22 18:02:46 +0800 2011","id":9506123090,"text":"\u201c\u4f60\u7684\u9f3b\u5b50\u3001\u4f60\u7684\u5fc3\u3001\u4f60\u7684\u68a6\uff0c\u4e09\u8005\u5408\u4e00\u65f6\u624d\u662f\u5c5e\u4e8e\u4f60\u7684\u9999\u6c1b\u3002\u8fd9\u610f\u5473\u7740\uff1a\u4f60\u80fd\u63a5\u53d7\u7684\u6c14\u5473\u3001\u4f60\u5185\u5fc3\u7684\u7f8e\u597d\u8bb0\u5fc6\u4ee5\u53ca\u4f60\u60f3\u8981\u6210\u4e3a\u7684\u90a3\u4e2a\u4f60\u3002\u201d","source":"<a href=\"http:\/\/weibo.com\" rel=\"nofollow\">\u65b0\u6d6a\u5fae\u535a<\/a>","favorited":false,"truncated":false,"in_reply_to_status_id":"","in_reply_to_user_id":"","in_reply_to_screen_name":"","geo":null,"mid":"5598346273260839667","user":{"id":2100649867,"screen_name":"\u6797\u6bd3\u4e302632","name":"\u6797\u6bd3\u4e302632","province":"14","city":"10","location":"\u5c71\u897f \u4e34\u6c7e","description":"","url":"","profile_image_url":"http:\/\/tp4.sinaimg.cn\/2100649867\/50\/5598433862\/0","domain":"","gender":"f","followers_count":0,"friends_count":21,"statuses_count":1,"favourites_count":0,"created_at":"Fri Apr 22 00:00:00 +0800 2011","following":false,"allow_all_act_msg":false,"geo_enabled":true,"verified":false},"annotations":[{"cartoon":false}]},{"created_at":"Fri Apr 22 18:02:44 +0800 2011","id":9506123246,"text":"[\u592a\u5f00\u5fc3] \u53c8\u662f\u4e00\u4e2a\u5468\u672b","source":"<a href=\"http:\/\/weibo.com\" rel=\"nofollow\">\u65b0\u6d6a\u5fae\u535a<\/a>","favorited":false,"truncated":false,"in_reply_to_status_id":"","in_reply_to_user_id":"","in_reply_to_screen_name":"","geo":null,"mid":"5598346264670904802","user":{"id":2100628797,"screen_name":"zhuangxinli","name":"zhuangxinli","province":"37","city":"11","location":"\u5c71\u4e1c \u65e5\u7167","description":"","url":"","profile_image_url":"http:\/\/tp2.sinaimg.cn\/2100628797\/50\/5598433443\/1","domain":"","gender":"m","followers_count":0,"friends_count":31,"statuses_count":0,"favourites_count":0,"created_at":"Fri Apr 22 00:00:00 +0800 2011","following":false,"allow_all_act_msg":false,"geo_enabled":true,"verified":false},"annotations":[{"cartoon":false}]}]';
exit;
		$kuids=rq("kuid","");
		if (!$kuids) return "";

		$kuidarr=explode(",",$kuids);
		$users = envhelper::readToken();

		$ms=array();
		foreach($kuidarr as $kuid){
			$k=envhelper::parseKUID($kuid);
			$lfrom=$k['lfrom'];

			$api="openapi_".$lfrom;
			importlib($api);
			$api=new $api(); 

			$client=$api->getClient($kuid);	
			///print_r($api->getUserInfo($kuid));
			$ms  = $client->public_timeline(); // done	
						
		}
		echo json_encode($ms);
		exit;
	}
	
	public function public_timeline(){


		$kuids=rq("kuid","");
		if (!$kuids) return "";

		$kuidarr=explode(",",$kuids);
		$users = envhelper::readToken();

		$ms=array();
		foreach($kuidarr as $kuid){
			$k=envhelper::parseKUID($kuid);
			$lfrom=$k['lfrom'];

			$api="openapi_".$lfrom;
			importlib($api);
			$api=new $api(); 

			$client=$api->getClient($kuid);	
			///print_r($api->getUserInfo($kuid));
			$ms  = $client->home_timeline(); // done	
						
		}
		echo json_encode($ms);
		exit;
	}

}
?>
